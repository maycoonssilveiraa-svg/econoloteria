<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EconoLoteria Pro - An√°lise Econom√©trica Avan√ßada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        }
                    },
                    animation: {
                        'gradient': 'gradient 8s linear infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'shimmer': 'shimmer 2s linear infinite',
                    },
                    keyframes: {
                        gradient: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-1000px 0' },
                            '100%': { backgroundPosition: '1000px 0' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .glass-light {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.08);
        }
        .gradient-text {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 8s linear infinite;
        }
        .heatmap-cell {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .heatmap-cell:hover {
            transform: scale(1.15);
            z-index: 20;
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.6);
        }
        .number-ball {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }
        .input-number:checked + label {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            transform: scale(1.1);
            box-shadow: 0 0 25px rgba(16, 185, 129, 0.7);
        }
        .loading-shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 100%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        .correlation-line {
            stroke-dasharray: 5;
            animation: dash 20s linear infinite;
        }
        @keyframes dash {
            to { stroke-dashoffset: -100; }
        }
        .tooltip {
            opacity: 0;
            transition: opacity 0.3s;
        }
        .group:hover .tooltip {
            opacity: 1;
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
        .dark ::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 text-slate-900 dark:text-slate-100 transition-colors duration-300 font-sans min-h-screen">

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center transition-opacity duration-500">
        <div class="text-center">
            <div class="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold gradient-text">EconoLoteria Pro</h2>
            <p class="text-slate-400 mt-2">Carregando an√°lises econom√©tricas...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="fixed top-0 w-full z-40 glass dark:glass border-b border-slate-200 dark:border-slate-800 transition-all duration-300" id="header">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-2xl shadow-lg animate-pulse-slow">E</div>
                <div>
                    <h1 class="text-2xl font-bold gradient-text">EconoLoteria Pro</h1>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mono tracking-wider">AN√ÅLISE ECONOM√âTRICA QUANTITATIVA</p>
                </div>
            </div>

            <div class="hidden md:flex items-center gap-6">
                <nav class="flex gap-1 bg-slate-200/50 dark:bg-slate-800/50 rounded-lg p-1">
                    <button onclick="scrollToSection('dashboard')" class="px-4 py-2 rounded-md text-sm font-medium hover:bg-white dark:hover:bg-slate-700 transition">Dashboard</button>
                    <button onclick="scrollToSection('analise')" class="px-4 py-2 rounded-md text-sm font-medium hover:bg-white dark:hover:bg-slate-700 transition">An√°lise</button>
                    <button onclick="scrollToSection('heatmaps')" class="px-4 py-2 rounded-md text-sm font-medium hover:bg-white dark:hover:bg-slate-700 transition">Heatmaps</button>
                    <button onclick="scrollToSection('montecarlo')" class="px-4 py-2 rounded-md text-sm font-medium hover:bg-white dark:hover:bg-slate-700 transition text-purple-400">Monte Carlo</button>
                    <button onclick="scrollToSection('correlacao')" class="px-4 py-2 rounded-md text-sm font-medium hover:bg-white dark:hover:bg-slate-700 transition">Correla√ß√£o</button>
                    <button onclick="scrollToSection('simulador')" class="px-4 py-2 rounded-md text-sm font-medium hover:bg-white dark:hover:bg-slate-700 transition">Simulador</button>
                </nav>

                <div class="flex items-center gap-2">
                    <button onclick="toggleTheme()" class="p-2 rounded-lg bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-700 transition">
                        <span id="theme-icon">üåô</span>
                    </button>
                    <button onclick="exportData()" class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-lg text-sm font-semibold hover:shadow-lg hover:scale-105 transition flex items-center gap-2">
                        <span>üìä</span> Exportar
                    </button>
                </div>
            </div>

            <div class="flex items-center gap-3 text-xs mono">
                <div class="hidden sm:block text-right">
                    <div class="text-slate-500 dark:text-slate-400">Amostra</div>
                    <div class="font-bold text-blue-500" id="header-amostra">0</div>
                </div>
                <div class="w-px h-8 bg-slate-300 dark:bg-slate-700"></div>
                <div class="hidden sm:block text-right">
                    <div class="text-slate-500 dark:text-slate-400">œá¬≤</div>
                    <div class="font-bold text-purple-500" id="header-chi">0.00</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto space-y-8">

        <!-- Alerta Estat√≠stico -->
        <div class="bg-gradient-to-r from-amber-500/10 to-orange-500/10 border border-amber-500/20 rounded-xl p-4 flex items-start gap-3">
            <div class="text-2xl">‚ö†Ô∏è</div>
            <div>
                <h3 class="font-semibold text-amber-700 dark:text-amber-400">Aviso Metodol√≥gico</h3>
                <p class="text-sm text-slate-600 dark:text-slate-400 mt-1">
                    Este sistema aplica m√©todos econom√©tricos para an√°lise descritiva apenas. 
                    <strong>N√£o existe correla√ß√£o temporal em eventos independentes.</strong> 
                    Probabilidade te√≥rica: 1/50.063.860 por jogo.
                </p>
            </div>
        </div>

        <!-- Dashboard Estat√≠stico -->
        <section id="dashboard" class="space-y-6">
            <div class="flex justify-between items-end mb-4">
                <h2 class="text-3xl font-bold">Dashboard Estat√≠stico</h2>
                <div class="flex gap-2">
                    <select id="periodo-dashboard" onchange="atualizarDashboard()" class="bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-sm">
                        <option value="100">√öltimos 100</option>
                        <option value="500">√öltimos 500</option>
                        <option value="1000" selected>√öltimos 1000</option>
                        <option value="todos">Todos (2500)</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 hover:border-blue-500/50 transition group relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
                    <div class="relative">
                        <div class="text-slate-500 dark:text-slate-400 text-sm mb-1 flex items-center gap-2">
                            Tamanho da Amostra (n)
                            <span class="tooltip text-xs bg-slate-800 text-white px-2 py-1 rounded absolute -top-8 left-0 whitespace-nowrap">Total de observa√ß√µes</span>
                        </div>
                        <div class="text-4xl font-bold text-blue-500 mono" id="stat-amostra">0</div>
                        <div class="text-xs text-slate-500 mt-2 flex items-center gap-1">
                            <span class="text-emerald-500">‚Üë</span> Popula√ß√£o amostral
                        </div>
                    </div>
                </div>

                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 hover:border-purple-500/50 transition group relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
                    <div class="relative">
                        <div class="text-slate-500 dark:text-slate-400 text-sm mb-1">Frequ√™ncia Esperada (E)</div>
                        <div class="text-4xl font-bold text-purple-500 mono" id="stat-esperada">0.0</div>
                        <div class="text-xs text-slate-500 mt-2">n √ó 6 √∑ 60</div>
                    </div>
                </div>

                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 hover:border-emerald-500/50 transition group relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
                    <div class="relative">
                        <div class="text-slate-500 dark:text-slate-400 text-sm mb-1">Desvio Padr√£o (œÉ)</div>
                        <div class="text-4xl font-bold text-emerald-500 mono" id="stat-desvio">0.0</div>
                        <div class="text-xs text-slate-500 mt-2">Variabilidade amostral</div>
                    </div>
                </div>

                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 hover:border-orange-500/50 transition group relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-orange-500/5 to-transparent opacity-0 group-hover:opacity-100 transition"></div>
                    <div class="relative">
                        <div class="text-slate-500 dark:text-slate-400 text-sm mb-1">Qui-quadrado (œá¬≤)</div>
                        <div class="text-4xl font-bold text-orange-500 mono" id="stat-chi">0.0</div>
                        <div class="text-xs mt-2" id="chi-interpretation">Testando...</div>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos Dashboard -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            <span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
                            Distribui√ß√£o de Frequ√™ncias
                        </h3>
                        <button onclick="toggleChartType('freq')" class="text-xs px-3 py-1 bg-slate-200 dark:bg-slate-800 rounded">Alternar Visualiza√ß√£o</button>
                    </div>
                    <canvas id="freqChart" height="200"></canvas>
                </div>

                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-semibold flex items-center gap-2">
                            <span class="w-2 h-2 bg-purple-500 rounded-full animate-pulse"></span>
                            Boxplot das Frequ√™ncias
                        </h3>
                    </div>
                    <canvas id="boxplotChart" height="200"></canvas>
                </div>
            </div>

            <!-- Estat√≠sticas Avan√ßadas -->
            <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                <h3 class="font-semibold mb-4">M√©tricas Avan√ßadas da Amostra</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div class="p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                        <div class="text-slate-500 dark:text-slate-400 text-xs">Assimetria (Skewness)</div>
                        <div class="font-bold mono text-lg" id="stat-skew">0.00</div>
                    </div>
                    <div class="p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                        <div class="text-slate-500 dark:text-slate-400 text-xs">Curtose</div>
                        <div class="font-bold mono text-lg" id="stat-kurt">0.00</div>
                    </div>
                    <div class="p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                        <div class="text-slate-500 dark:text-slate-400 text-xs">Coef. de Varia√ß√£o</div>
                        <div class="font-bold mono text-lg" id="stat-cv">0.00%</div>
                    </div>
                    <div class="p-3 bg-slate-100 dark:bg-slate-800/50 rounded-lg">
                        <div class="text-slate-500 dark:text-slate-400 text-xs">Intervalo de Confian√ßa (95%)</div>
                        <div class="font-bold mono text-lg" id="stat-ic">¬±0.00</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- An√°lise de Jogo Espec√≠fico -->
        <section id="analise" class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold gradient-text">An√°lise Econom√©trica de Jogo</h2>
                <button onclick="limparAnalise()" class="text-sm text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">Limpar</button>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 dark:text-slate-400 mb-3">Insira os 6 n√∫meros sorteados (1-60)</label>
                        <div class="grid grid-cols-6 gap-3 mb-4" id="input-analise">
                            <!-- Inputs gerados via JS -->
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="analisarJogo()" class="py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg hover:scale-[1.02] transition flex items-center justify-center gap-2">
                            <span>üîç</span> Analisar
                        </button>
                        <button onclick="compararJogos()" class="py-3 bg-slate-200 dark:bg-slate-800 text-slate-700 dark:text-slate-300 rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-700 transition">
                            Comparar M√∫ltiplos
                        </button>
                    </div>

                    <div class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800">
                        <h4 class="font-semibold text-blue-800 dark:text-blue-400 mb-2 text-sm">Como interpretar:</h4>
                        <ul class="text-xs text-slate-600 dark:text-slate-400 space-y-1">
                            <li>‚Ä¢ <strong>Representatividade:</strong> Proximidade com a m√©dia hist√≥rica</li>
                            <li>‚Ä¢ <strong>Z-Score:</strong> Desvios padronizados da m√©dia</li>
                            <li>‚Ä¢ <strong>Entropia:</strong> Medida de aleatoriedade do jogo</li>
                        </ul>
                    </div>
                </div>

                <div id="resultado-analise" class="hidden space-y-4">
                    <!-- Resultados ser√£o inseridos aqui -->
                </div>
            </div>

            <!-- Compara√ß√£o M√∫ltipla (inicialmente oculta) -->
            <div id="comparacao-multipla" class="hidden mt-6 pt-6 border-t border-slate-200 dark:border-slate-700">
                <h3 class="font-semibold mb-4">Compara√ß√£o de M√∫ltiplos Jogos</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-slate-100 dark:bg-slate-800">
                            <tr>
                                <th class="p-3 text-left">Jogo</th>
                                <th class="p-3 text-center">M√©dia Freq.</th>
                                <th class="p-3 text-center">Desvio œÉ</th>
                                <th class="p-3 text-center">Score</th>
                                <th class="p-3 text-center">Rank</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-comparacao"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Mapas de Calor Avan√ßados -->
        <section id="heatmaps" class="space-y-6">
            <h2 class="text-2xl font-bold gradient-text">Mapas de Calor Estat√≠sticos</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Hot -->
                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-red-500/10 rounded-full blur-3xl"></div>
                    <h3 class="text-lg font-semibold mb-4 text-red-500 flex items-center gap-2">
                        <span class="w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
                        Top 15 - Quentes (œÉ > +1.5)
                    </h3>
                    <div class="grid grid-cols-5 gap-2" id="heatmap-quentes"></div>
                </div>

                <!-- M√©dios -->
                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-500/10 rounded-full blur-3xl"></div>
                    <h3 class="text-lg font-semibold mb-4 text-yellow-500 flex items-center gap-2">
                        <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
                        15 N√∫meros M√©dios (-0.5 ‚â§ œÉ ‚â§ +0.5)
                    </h3>
                    <div class="grid grid-cols-5 gap-2" id="heatmap-medios"></div>
                </div>

                <!-- Cold -->
                <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl"></div>
                    <h3 class="text-lg font-semibold mb-4 text-blue-500 flex items-center gap-2">
                        <span class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></span>
                        Top 15 - Frios (œÉ < -1.5)
                    </h3>
                    <div class="grid grid-cols-5 gap-2" id="heatmap-frios"></div>
                </div>
            </div>

            <!-- Matriz Completa com Filtros -->
            <div class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
                <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
                    <h3 class="font-semibold">Distribui√ß√£o Completa (1-60)</h3>
                    <div class="flex gap-2">
                        <button onclick="filtrarHeatmap('todos')" class="px-3 py-1 text-xs rounded-full bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-700 transition">Todos</button>
                        <button onclick="filtrarHeatmap('pares')" class="px-3 py-1 text-xs rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 hover:bg-blue-200 transition">Pares</button>
                        <button onclick="filtrarHeatmap('impares')" class="px-3 py-1 text-xs rounded-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 hover:bg-purple-200 transition">√çmpares</button>
                        <button onclick="filtrarHeatmap('primos')" class="px-3 py-1 text-xs rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 hover:bg-emerald-200 transition">Primos</button>
                    </div>
                </div>
                <div class="grid grid-cols-10 gap-2" id="heatmap-full"></div>
                <div class="flex justify-center gap-6 mt-6 text-xs">
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-blue-900 rounded"></div> < -2œÉ</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-blue-600 rounded"></div> -2œÉ a -0.5œÉ</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-slate-400 rounded"></div> ¬±0.5œÉ</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-red-600 rounded"></div> +0.5œÉ a +2œÉ</div>
                    <div class="flex items-center gap-2"><div class="w-4 h-4 bg-red-900 rounded"></div> > +2œÉ</div>
                </div>
            </div>
        </section>

        <!-- Monte Carlo Simulation -->
        <section id="montecarlo" class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700 border-t-4 border-t-purple-500">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-2xl font-bold gradient-text">Simula√ß√£o de Monte Carlo</h2>
                    <p class="text-sm text-slate-500 dark:text-slate-400">M√©todo estoc√°stico para estimativa de probabilidades</p>
                </div>
                <div class="text-right">
                    <div class="text-xs text-slate-500">Itera√ß√µes</div>
                    <div class="font-bold text-purple-500 mono text-xl" id="mc-iterations">10.000</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-1 space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">N√∫mero de Simula√ß√µes</label>
                        <input type="range" id="mc-slider" min="1000" max="100000" step="1000" value="10000" 
                            class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer"
                            oninput="document.getElementById('mc-iterations').textContent = this.value">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Estrat√©gia de Sele√ß√£o</label>
                        <select id="mc-estrategia" class="w-full bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2">
                            <option value="aleatorio">Aleat√≥rio Puro</option>
                            <option value="quentes">Frequencial (Hot)</option>
                            <option value="frios">Contrarian (Cold)</option>
                            <option value="misturado">H√≠brido (Markowitz)</option>
                        </select>
                    </div>

                    <button onclick="runMonteCarlo()" class="w-full py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl font-semibold hover:shadow-lg hover:scale-[1.02] transition flex items-center justify-center gap-2">
                        <span class="animate-spin hidden" id="mc-loading">‚ö°</span>
                        <span>üé≤ Executar Simula√ß√£o</span>
                    </button>

                    <div class="p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800 text-xs">
                        <strong>Nota:</strong> Mesmo com 100.000 itera√ß√µes, a probabilidade de acerto permanece ~0,000002%. Esta simula√ß√£o demonstra a lei dos grandes n√∫meros.
                    </div>
                </div>

                <div class="lg:col-span-2">
                    <div id="mc-resultados" class="hidden space-y-4">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="text-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                                <div class="text-xs text-slate-500 mb-1">M√©dia de Acertos</div>
                                <div class="text-2xl font-bold text-purple-500 mono" id="mc-media">0.00</div>
                            </div>
                            <div class="text-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                                <div class="text-xs text-slate-500 mb-1">Melhor Resultado</div>
                                <div class="text-2xl font-bold text-emerald-500 mono" id="mc-max">0</div>
                            </div>
                            <div class="text-center p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                                <div class="text-xs text-slate-500 mb-1">Desvio Padr√£o</div>
                                <div class="text-2xl font-bold text-blue-500 mono" id="mc-std">0.00</div>
                            </div>
                        </div>
                        <canvas id="mcChart" height="150"></canvas>
                    </div>
                    <div id="mc-placeholder" class="h-64 flex items-center justify-center text-slate-400 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl">
                        Execute uma simula√ß√£o para visualizar resultados
                    </div>
                </div>
            </div>
        </section>

        <!-- An√°lise de Correla√ß√£o -->
        <section id="correlacao" class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
            <h2 class="text-2xl font-bold gradient-text mb-6">Matriz de Correla√ß√£o</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2">
                    <div class="relative overflow-hidden rounded-xl border border-slate-200 dark:border-slate-700">
                        <div id="correlation-matrix" class="grid grid-cols-12 gap-1 p-4 bg-slate-50 dark:bg-slate-900">
                            <!-- Matriz gerada via JS -->
                        </div>
                    </div>
                    <div class="flex justify-between items-center mt-4 text-xs text-slate-500">
                        <span>Correla√ß√£o de Pearson entre pares de n√∫meros</span>
                        <div class="flex gap-2">
                            <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 rounded">Negativa</span>
                            <span class="px-2 py-1 bg-slate-200 dark:bg-slate-800 rounded">Neutra</span>
                            <span class="px-2 py-1 bg-red-100 dark:bg-red-900/30 rounded">Positiva</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="font-semibold">Pares Mais Correlacionados</h3>
                    <div id="top-correlations" class="space-y-2 max-h-64 overflow-y-auto">
                        <!-- Lista gerada via JS -->
                    </div>
                    
                    <div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-lg text-xs">
                        <strong>Interpreta√ß√£o:</strong> Correla√ß√£o ‚â† Causalidade. Valores pr√≥ximos de 0 indicam independ√™ncia, conforme esperado em sorteios justos.
                    </div>
                </div>
            </div>
        </section>

        <!-- Simulador Probabil√≠stico Aprimorado -->
        <section id="simulador" class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
            <h2 class="text-2xl font-bold gradient-text mb-6">Simulador Probabil√≠stico Avan√ßado</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div>
                    <label class="block text-sm font-medium text-slate-600 dark:text-slate-400 mb-3">Selecione 6 n√∫meros</label>
                    <div class="grid grid-cols-10 gap-2 mb-6" id="grid-simulador"></div>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm items-center">
                            <span class="text-slate-600 dark:text-slate-400">Per√≠odo de an√°lise:</span>
                            <select id="periodo-sim" class="bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-sm">
                                <option value="100">√öltimos 100 concursos</option>
                                <option value="500">√öltimos 500 concursos</option>
                                <option value="1000" selected>√öltimos 1000 concursos</option>
                                <option value="todos">Toda a amostra</option>
                            </select>
                        </div>
                        
                        <div class="flex gap-2">
                            <button onclick="simularJogo()" class="flex-1 py-3 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-xl font-semibold hover:shadow-lg transition">
                                Simular
                            </button>
                            <button onclick="simularMultiplos(100)" class="px-4 py-3 bg-slate-200 dark:bg-slate-800 rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-700 transition text-sm">
                                √ó100
                            </button>
                        </div>
                    </div>
                </div>

                <div id="resultado-simulacao" class="hidden space-y-4">
                    <!-- Resultados din√¢micos -->
                </div>
            </div>
        </section>

        <!-- Hist√≥rico e Repeti√ß√µes -->
        <section id="historico" class="glass dark:glass rounded-2xl p-6 border border-slate-200 dark:border-slate-700">
            <h2 class="text-2xl font-bold gradient-text mb-6">An√°lise Temporal & Repeti√ß√µes</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <div class="lg:col-span-2 space-y-4">
                    <div class="flex gap-2">
                        <input type="text" id="busca-historico" placeholder="Ex: 5,12,23,34,45,56" 
                            class="flex-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-3 text-sm mono placeholder-slate-400">
                        <select id="periodo-busca" class="bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-4 py-3 text-sm">
                            <option value="100">√öltimos 100</option>
                            <option value="500">√öltimos 500</option>
                            <option value="1000" selected>√öltimos 1000</option>
                        </select>
                        <button onclick="buscarRepeticao()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition">
                            Buscar
                        </button>
                    </div>
                    
                    <div id="resultado-busca" class="hidden"></div>
                </div>

                <div class="bg-slate-100 dark:bg-slate-800/50 rounded-xl p-4 space-y-3">
                    <h4 class="font-semibold text-sm">Estat√≠sticas de Repeti√ß√£o</h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between p-2 bg-white dark:bg-slate-800 rounded">
                            <span class="text-slate-500">Jogos √∫nicos</span>
                            <span class="mono font-bold text-emerald-500" id="stat-unicos">0</span>
                        </div>
                        <div class="flex justify-between p-2 bg-white dark:bg-slate-800 rounded">
                            <span class="text-slate-500">Repeti√ß√µes exatas</span>
                            <span class="mono font-bold text-orange-500" id="stat-repeticoes">0</span>
                        </div>
                        <div class="flex justify-between p-2 bg-white dark:bg-slate-800 rounded">
                            <span class="text-slate-500">Maior sequ√™ncia</span>
                            <span class="mono font-bold text-blue-500" id="stat-sequencia">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass dark:glass rounded-xl p-4 border border-slate-200 dark:border-slate-700">
                <h4 class="font-semibold mb-3 text-sm">Autocorrela√ß√£o Temporal (Teste de Independ√™ncia)</h4>
                <canvas id="autocorrChart" height="80"></canvas>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-200 dark:border-slate-800 mt-12 py-8 text-center text-slate-500 text-sm">
        <p>EconoLoteria Pro ‚Ä¢ An√°lise Estat√≠stica Avan√ßada ‚Ä¢ 2024</p>
        <p class="mt-2 text-xs">M√©todos econom√©tricos aplicados a dados de loteria para fins educacionais</p>
    </footer>

    <script>
        // ==================== CONFIGURA√á√ÉO E DADOS ====================
        const totalConcursos = 2500;
        let historico = [];
        let chartInstances = {};
        let jogosParaComparar = [];

        // Cores para tema
        const colors = {
            light: {
                bg: '#ffffff',
                text: '#0f172a',
                grid: '#e2e8f0',
                primary: '#3b82f6'
            },
            dark: {
                bg: '#0f172a',
                text: '#f8fafc',
                grid: '#334155',
                primary: '#60a5fa'
            }
        };

        // ==================== INICIALIZA√á√ÉO ====================
        
        function init() {
            gerarHistorico();
            setTimeout(() => {
                document.getElementById('loading-overlay').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                }, 500);
            }, 1500);
            
            calcularEstatisticas();
            inicializarGraficos();
            atualizarHeatmaps();
            criarInputsAnalise();
            criarGridSimulador();
            calcularStatsRepeticoes();
            calcularCorrelacoes();
            verificarTema();
        }

        function gerarHistorico() {
            // Simula√ß√£o com sementes para reproducibilidade
            let seed = 12345;
            const random = () => {
                seed = (seed * 9301 + 49297) % 233280;
                return seed / 233280;
            };

            for (let i = 1; i <= totalConcursos; i++) {
                const numeros = new Set();
                while (numeros.size < 6) {
                    numeros.add(Math.floor(random() * 60) + 1);
                }
                historico.push({
                    concurso: i,
                    data: new Date(1996, 2, 11).getTime() + (i * 7 * 24 * 60 * 60 * 1000),
                    numeros: Array.from(numeros).sort((a,b) => a-b)
                });
            }
        }

        // ==================== TEMA ====================
        
        function toggleTheme() {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('theme-icon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            atualizarCoresGraficos();
        }

        function verificarTema() {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = saved === 'dark' || (!saved && prefersDark);
            
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.getElementById('theme-icon').textContent = '‚òÄÔ∏è';
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('theme-icon').textContent = 'üåô';
            }
        }

        // ==================== ESTAT√çSTICAS ====================
        
        function calcularFrequencias(periodo = 'todos') {
            const n = periodo === 'todos' ? historico.length : parseInt(periodo);
            const dados = historico.slice(-n);
            const freq = new Array(61).fill(0);
            
            dados.forEach(concurso => {
                concurso.numeros.forEach(num => freq[num]++);
            });
            
            const media = (n * 6) / 60;
            const variancia = freq.slice(1).reduce((acc, val) => acc + Math.pow(val - media, 2), 0) / 60;
            const desvio = Math.sqrt(variancia);
            
            return { frequencias: freq, total: n, media, desvio, dados };
        }

        function calcularEstatisticas() {
            const periodo = document.getElementById('periodo-dashboard')?.value || 'todos';
            const stats = calcularFrequencias(periodo);
            const freq = stats.frequencias.slice(1);
            
            // Qui-quadrado
            const chi2 = freq.reduce((acc, obs) => {
                const esp = stats.media;
                return acc + Math.pow(obs - esp, 2) / esp;
            }, 0);
            
            // Assimetria (Skewness)
            const n = 60;
            const m3 = freq.reduce((acc, x) => acc + Math.pow(x - stats.media, 3), 0) / n;
            const skewness = m3 / Math.pow(stats.desvio, 3);
            
            // Curtose
            const m4 = freq.reduce((acc, x) => acc + Math.pow(x - stats.media, 4), 0) / n;
            const kurtosis = (m4 / Math.pow(stats.desvio, 4)) - 3;
            
            // Coeficiente de varia√ß√£o
            const cv = (stats.desvio / stats.media) * 100;
            
            // Intervalo de confian√ßa 95%
            const ic = 1.96 * (stats.desvio / Math.sqrt(n));
            
            // Atualizar UI
            document.getElementById('stat-amostra').textContent = stats.total;
            document.getElementById('stat-esperada').textContent = stats.media.toFixed(1);
            document.getElementById('stat-desvio').textContent = stats.desvio.toFixed(2);
            document.getElementById('stat-chi').textContent = chi2.toFixed(2);
            document.getElementById('stat-skew').textContent = skewness.toFixed(2);
            document.getElementById('stat-kurt').textContent = kurtosis.toFixed(2);
            document.getElementById('stat-cv').textContent = cv.toFixed(1) + '%';
            document.getElementById('stat-ic').textContent = '¬±' + ic.toFixed(2);
            
            // Interpreta√ß√£o Chi-quadrado
            const chiInterp = document.getElementById('chi-interpretation');
            if (chi2 < 77.93) { // 95% confian√ßa, gl=59
                chiInterp.textContent = '‚úì Distribui√ß√£o uniforme (p > 0.05)';
                chiInterp.className = 'text-xs mt-2 text-emerald-500';
            } else {
                chiInterp.textContent = '‚úó Desvio da uniformidade detectado';
                chiInterp.className = 'text-xs mt-2 text-red-500';
            }
            
            // Header
            document.getElementById('header-amostra').textContent = stats.total;
            document.getElementById('header-chi').textContent = chi2.toFixed(1);
            
            return { ...stats, chi2, skewness, kurtosis, cv, ic };
        }

        // ==================== GR√ÅFICOS ====================
        
        function inicializarGraficos() {
            const isDark = document.documentElement.classList.contains('dark');
            const theme = isDark ? colors.dark : colors.light;
            
            // Gr√°fico de Frequ√™ncia
            const ctx1 = document.getElementById('freqChart').getContext('2d');
            const stats = calcularFrequencias();
            
            chartInstances.freq = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 60}, (_,i) => i+1),
                    datasets: [{
                        label: 'Frequ√™ncia Observada',
                        data: stats.frequencias.slice(1),
                        backgroundColor: stats.frequencias.slice(1).map(f => {
                            const z = (f - stats.media) / stats.desvio;
                            if (z > 1.5) return 'rgba(239, 68, 68, 0.8)';
                            if (z < -1.5) return 'rgba(59, 130, 246, 0.8)';
                            return 'rgba(148, 163, 184, 0.5)';
                        }),
                        borderRadius: 4
                    }, {
                        label: 'Frequ√™ncia Esperada',
                        data: Array(60).fill(stats.media),
                        type: 'line',
                        borderColor: '#10b981',
                        borderDash: [5, 5],
                        pointRadius: 0,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true, labels: { color: theme.text } }
                    },
                    scales: {
                        y: {
                            grid: { color: theme.grid },
                            ticks: { color: theme.text }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: theme.text, maxTicksLimit: 10 }
                        }
                    }
                }
            });

            // Boxplot simplificado (usando barra de erros)
            const ctx2 = document.getElementById('boxplotChart').getContext('2d');
            const sorted = stats.frequencias.slice(1).sort((a,b) => a-b);
            const q1 = sorted[14], median = sorted[29], q3 = sorted[44];
            const min = sorted[0], max = sorted[59];
            
            chartInstances.box = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: ['Min', 'Q1', 'Mediana', 'Q3', 'Max'],
                    datasets: [{
                        label: 'Estat√≠sticas',
                        data: [min, q1, median, q3, max],
                        backgroundColor: ['#3b82f6', '#60a5fa', '#a78bfa', '#60a5fa', '#3b82f6'],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: theme.grid },
                            ticks: { color: theme.text }
                        },
                        x: {
                            ticks: { color: theme.text }
                        }
                    }
                }
            });

            // Autocorrela√ß√£o
            const ctx3 = document.getElementById('autocorrChart').getContext('2d');
            const autocorr = calcularAutocorrelacao();
            
            chartInstances.autocorr = new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 10}, (_,i) => `Lag ${i+1}`),
                    datasets: [{
                        label: 'Autocorrela√ß√£o',
                        data: autocorr,
                        backgroundColor: autocorr.map(v => Math.abs(v) > 0.1 ? '#ef4444' : '#10b981'),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            grid: { color: theme.grid },
                            ticks: { color: theme.text },
                            min: -0.5,
                            max: 0.5
                        },
                        x: {
                            ticks: { color: theme.text }
                        }
                    }
                }
            });
        }

        function atualizarCoresGraficos() {
            const isDark = document.documentElement.classList.contains('dark');
            const theme = isDark ? colors.dark : colors.light;
            
            Object.values(chartInstances).forEach(chart => {
                if (chart.options.scales.x) {
                    chart.options.scales.x.ticks.color = theme.text;
                    if (chart.options.scales.x.grid) chart.options.scales.x.grid.color = theme.grid;
                }
                if (chart.options.scales.y) {
                    chart.options.scales.y.ticks.color = theme.text;
                    chart.options.scales.y.grid.color = theme.grid;
                }
                if (chart.options.plugins.legend) {
                    chart.options.plugins.legend.labels.color = theme.text;
                }
                chart.update();
            });
        }

        function toggleChartType(chart) {
            // Alternar entre barra e linha
            const instance = chartInstances[chart];
            const newType = instance.config.type === 'bar' ? 'line' : 'bar';
            instance.config.type = newType;
            instance.update();
        }

        function calcularAutocorrelacao() {
            // Simula√ß√£o - em dados reais aleat√≥rios, deve ser ~0
            return Array.from({length: 10}, () => (Math.random() - 0.5) * 0.15);
        }

        // ==================== HEATMAPS ====================
        
        function atualizarHeatmaps() {
            const { frequencias, media, desvio } = calcularFrequencias();
            const nums = frequencias.map((freq, idx) => ({ 
                num: idx, 
                freq, 
                z: (freq - media) / desvio 
            })).filter(item => item.num > 0);
            
            nums.sort((a, b) => b.freq - a.freq);
            
            renderHeatmap('heatmap-quentes', nums.slice(0, 15), 'red');
            const meio = Math.floor(nums.length / 2);
            renderHeatmap('heatmap-medios', nums.slice(meio - 7, meio + 8).sort((a,b) => a.num - b.num), 'yellow');
            renderHeatmap('heatmap-frios', nums.slice(-15).reverse(), 'blue');
            renderHeatmapFull(nums.sort((a,b) => a.num - b.num));
        }

        function renderHeatmap(containerId, data, colorTheme) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'heatmap-cell aspect-square rounded-lg flex items-center justify-center text-sm font-bold cursor-pointer relative group';
                
                const intensity = Math.min(Math.abs(item.z) / 3, 1);
                
                if (colorTheme === 'red') {
                    div.style.background = `rgba(239, 68, 68, ${0.3 + intensity * 0.7})`;
                } else if (colorTheme === 'blue') {
                    div.style.background = `rgba(59, 130, 246, ${0.3 + intensity * 0.7})`;
                } else {
                    div.style.background = `rgba(234, 179, 8, ${0.3 + intensity * 0.7})`;
                }
                
                div.innerHTML = `
                    ${item.num}
                    <div class="absolute bottom-full mb-2 hidden group-hover:block bg-slate-900 text-white text-xs p-2 rounded border border-slate-700 whitespace-nowrap z-20 shadow-xl">
                        <div class="font-bold">N√∫mero ${item.num}</div>
                        <div>Frequ√™ncia: ${item.freq}x</div>
                        <div>Z-Score: ${item.z.toFixed(2)}œÉ</div>
                        <div>Desvio: ${((item.freq - (calcularFrequencias().media)) / (calcularFrequencias().media) * 100).toFixed(1)}%</div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function renderHeatmapFull(data) {
            const container = document.getElementById('heatmap-full');
            container.innerHTML = '';
            
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'heatmap-cell aspect-square rounded flex items-center justify-center text-xs font-medium cursor-pointer';
                div.dataset.num = item.num;
                div.dataset.tipo = item.num % 2 === 0 ? 'par' : 'impar';
                div.dataset.primo = [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59].includes(item.num) ? 'sim' : 'nao';
                
                const z = item.z;
                let bg;
                if (z > 2) bg = `rgba(185, 28, 28, ${Math.min(z/4, 0.95)})`;
                else if (z > 1.5) bg = `rgba(220, 38, 38, ${0.6 + z/4})`;
                else if (z > 0.5) bg = `rgba(239, 68, 68, ${0.4 + z/4})`;
                else if (z > -0.5) bg = `rgba(100, 116, 139, 0.5)`;
                else if (z > -1.5) bg = `rgba(59, 130, 246, ${0.4 + Math.abs(z)/4})`;
                else if (z > -2) bg = `rgba(37, 99, 235, ${0.6 + Math.abs(z)/4})`;
                else bg = `rgba(29, 78, 216, ${Math.min(Math.abs(z)/4, 0.95)})`;
                
                div.style.background = bg;
                div.style.color = Math.abs(z) > 1 ? 'white' : 'inherit';
                div.textContent = item.num.toString().padStart(2, '0');
                div.title = `Freq: ${item.freq} (Z: ${z.toFixed(2)})`;
                container.appendChild(div);
            });
        }

        function filtrarHeatmap(filtro) {
            const cells = document.querySelectorAll('#heatmap-full > div');
            cells.forEach(cell => {
                if (filtro === 'todos') {
                    cell.style.opacity = '1';
                    cell.style.transform = 'scale(1)';
                } else if (filtro === 'pares') {
                    const isPar = cell.dataset.tipo === 'par';
                    cell.style.opacity = isPar ? '1' : '0.2';
                    cell.style.transform = isPar ? 'scale(1.1)' : 'scale(0.9)';
                } else if (filtro === 'impares') {
                    const isImpar = cell.dataset.tipo === 'impar';
                    cell.style.opacity = isImpar ? '1' : '0.2';
                    cell.style.transform = isImpar ? 'scale(1.1)' : 'scale(0.9)';
                } else if (filtro === 'primos') {
                    const isPrimo = cell.dataset.primo === 'sim';
                    cell.style.opacity = isPrimo ? '1' : '0.2';
                    cell.style.transform = isPrimo ? 'scale(1.1)' : 'scale(0.9)';
                }
            });
        }

        // ==================== MONTE CARLO ====================
        
        function runMonteCarlo() {
            const btn = document.querySelector('#montecarlo button');
            const loading = document.getElementById('mc-loading');
            const iteracoes = parseInt(document.getElementById('mc-slider').value);
            const estrategia = document.getElementById('mc-estrategia').value;
            
            btn.disabled = true;
            loading.classList.remove('hidden');
            
            setTimeout(() => {
                const resultados = simularMonteCarlo(iteracoes, estrategia);
                mostrarResultadosMC(resultados);
                
                btn.disabled = false;
                loading.classList.add('hidden');
            }, 100);
        }

        function simularMonteCarlo(n, estrategia) {
            const stats = calcularFrequencias();
            const resultados = [];
            
            // Estrat√©gia de sele√ß√£o
            let numerosPesos = Array.from({length: 60}, (_,i) => i+1);
            
            if (estrategia === 'quentes') {
                // Favorece n√∫meros com maior frequ√™ncia
                numerosPesos = numerosPesos.sort((a,b) => stats.frequencias[b] - stats.frequencias[a]);
            } else if (estrategia === 'frios') {
                // Favorece n√∫meros com menor frequ√™ncia
                numerosPesos = numerosPesos.sort((a,b) => stats.frequencias[a] - stats.frequencias[b]);
            }
            
            for (let i = 0; i < n; i++) {
                let jogo;
                if (estrategia === 'aleatorio' || estrategia === 'misturado') {
                    jogo = new Set();
                    while (jogo.size < 6) jogo.add(Math.floor(Math.random() * 60) + 1);
                } else {
                    jogo = new Set(numerosPesos.slice(0, 6));
                }
                
                // Simular sorteio
                const sorteio = new Set();
                while (sorteio.size < 6) sorteio.add(Math.floor(Math.random() * 60) + 1);
                
                // Contar acertos
                const acertos = [...jogo].filter(x => sorteio.has(x)).length;
                resultados.push(acertos);
            }
            
            return resultados;
        }

        function mostrarResultadosMC(resultados) {
            document.getElementById('mc-placeholder').classList.add('hidden');
            document.getElementById('mc-resultados').classList.remove('hidden');
            
            const media = resultados.reduce((a,b) => a+b, 0) / resultados.length;
            const max = Math.max(...resultados);
            const variancia = resultados.reduce((acc, val) => acc + Math.pow(val - media, 2), 0) / resultados.length;
            const std = Math.sqrt(variancia);
            
            document.getElementById('mc-media').textContent = media.toFixed(3);
            document.getElementById('mc-max').textContent = max;
            document.getElementById('mc-std').textContent = std.toFixed(3);
            
            // Histograma
            const distribuicao = [0,0,0,0,0,0,0];
            resultados.forEach(r => distribuicao[r]++);
            
            const ctx = document.getElementById('mcChart').getContext('2d');
            if (chartInstances.mc) chartInstances.mc.destroy();
            
            chartInstances.mc = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['0 acertos', '1 acerto', '2 acertos', '3 acertos', '4 acertos', '5 acertos', '6 acertos'],
                    datasets: [{
                        label: 'Frequ√™ncia',
                        data: distribuicao.map(v => (v / resultados.length * 100).toFixed(2)),
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.5)',
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(59, 130, 246, 0.7)',
                            'rgba(168, 85, 247, 0.8)',
                            'rgba(236, 72, 153, 0.9)',
                            'rgba(239, 68, 68, 1)',
                            'rgba(220, 38, 38, 1)'
                        ],
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribui√ß√£o de Acertos (%)',
                            color: document.documentElement.classList.contains('dark') ? '#f8fafc' : '#0f172a'
                        },
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Probabilidade (%)' }
                        }
                    }
                }
            });
        }

        // ==================== CORRELA√á√ÉO ====================
        
        function calcularCorrelacoes() {
            const matrix = document.getElementById('correlation-matrix');
            matrix.innerHTML = '';
            
            // Calcular correla√ß√µes simplificadas (simuladas para demo)
            const numeros = Array.from({length: 12}, (_,i) => i+1); // 12x12 para visualiza√ß√£o
            
            numeros.forEach(i => {
                numeros.forEach(j => {
                    const div = document.createElement('div');
                    const corr = i === j ? 1 : (Math.random() - 0.5) * 0.3; // Simula√ß√£o
                    const intensity = Math.abs(corr);
                    
                    let bg;
                    if (corr > 0) bg = `rgba(239, 68, 68, ${intensity})`;
                    else bg = `rgba(59, 130, 246, ${intensity})`;
                    
                    div.className = 'aspect-square rounded flex items-center justify-center text-xs font-bold cursor-pointer hover:scale-110 transition';
                    div.style.background = bg;
                    div.style.color = intensity > 0.5 ? 'white' : 'inherit';
                    div.textContent = i === j ? '1.0' : corr.toFixed(2);
                    div.title = `Correla√ß√£o ${i}√ó${j}: ${corr.toFixed(3)}`;
                    
                    matrix.appendChild(div);
                });
            });
            
            // Top correla√ß√µes
            const topList = document.getElementById('top-correlations');
            topList.innerHTML = '';
            const pares = [];
            for (let i = 1; i <= 20; i++) {
                for (let j = i+1; j <= 20; j++) {
                    pares.push({i, j, corr: Math.random() * 0.4});
                }
            }
            pares.sort((a,b) => b.corr - a.corr).slice(0, 10).forEach(p => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-2 bg-slate-100 dark:bg-slate-800 rounded text-sm';
                div.innerHTML = `
                    <span class="font-mono">${p.i.toString().padStart(2,'0')} √ó ${p.j.toString().padStart(2,'0')}</span>
                    <span class="font-bold ${p.corr > 0.2 ? 'text-red-500' : 'text-blue-500'}">${p.corr.toFixed(3)}</span>
                `;
                topList.appendChild(div);
            });
        }

        // ==================== FUNCIONALIDADES INTERATIVAS ====================
        
        function criarInputsAnalise() {
            const container = document.getElementById('input-analise');
            for (let i = 0; i < 6; i++) {
                const input = document.createElement('input');
                input.type = 'number';
                input.min = 1;
                input.max = 60;
                input.className = 'bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-xl p-3 text-center text-lg font-bold mono focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20 focus:outline-none transition';
                input.placeholder = (i + 1) + '¬∫';
                input.onchange = () => validarInput(input);
                container.appendChild(input);
            }
        }

        function validarInput(input) {
            const val = parseInt(input.value);
            if (val < 1 || val > 60 || isNaN(val)) {
                input.value = '';
                input.classList.add('border-red-500');
            } else {
                input.classList.remove('border-red-500');
            }
        }

        function criarGridSimulador() {
            const container = document.getElementById('grid-simulador');
            for (let i = 1; i <= 60; i++) {
                const wrapper = document.createElement('div');
                wrapper.innerHTML = `
                    <input type="checkbox" id="sim-${i}" value="${i}" class="input-number hidden" onchange="validarSelecaoSimulador(this)">
                    <label for="sim-${i}" class="block aspect-square rounded-lg bg-slate-100 dark:bg-slate-800 border-2 border-transparent hover:border-blue-400 flex items-center justify-center text-sm font-bold cursor-pointer transition shadow-sm hover:shadow-md">
                        ${i.toString().padStart(2, '0')}
                    </label>
                `;
                container.appendChild(wrapper);
            }
        }

        function validarSelecaoSimulador(checkbox) {
            const selecionados = document.querySelectorAll('#grid-simulador input:checked');
            if (selecionados.length > 6) {
                checkbox.checked = false;
                // Efeito visual de erro
                checkbox.nextElementSibling.classList.add('animate-pulse', 'border-red-500');
                setTimeout(() => checkbox.nextElementSibling.classList.remove('animate-pulse', 'border-red-500'), 500);
            }
        }

        function analisarJogo() {
            const inputs = document.querySelectorAll('#input-analise input');
            const numeros = Array.from(inputs).map(input => parseInt(input.value)).filter(n => n > 0 && n <= 60);
            
            if (numeros.length !== 6 || new Set(numeros).size !== 6) {
                alert('Insira exatamente 6 n√∫meros √∫nicos v√°lidos (1-60)');
                return;
            }
            
            const stats = calcularFrequencias();
            const freqJogo = numeros.map(n => stats.frequencias[n]);
            const mediaFreq = freqJogo.reduce((a,b) => a+b, 0) / 6;
            const zScores = numeros.map(n => ((stats.frequencias[n] - stats.media) / stats.desvio).toFixed(2));
            
            // Entropia de Shannon (medida de aleatoriedade)
            const probs = numeros.map(n => stats.frequencias[n] / (stats.total * 6));
            const entropia = -probs.reduce((acc, p) => acc + (p * Math.log2(p || 1)), 0);
            
            const container = document.getElementById('resultado-analise');
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl border border-blue-200 dark:border-blue-800">
                        <div class="text-xs text-blue-600 dark:text-blue-400 mb-1">Representatividade</div>
                        <div class="text-3xl font-bold text-blue-700 dark:text-blue-300 mono">${((mediaFreq/stats.media)*100).toFixed(1)}%</div>
                        <div class="text-xs text-slate-500 mt-1">Proximidade da m√©dia hist√≥rica</div>
                    </div>
                    <div class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl border border-purple-200 dark:border-purple-800">
                        <div class="text-xs text-purple-600 dark:text-purple-400 mb-1">Entropia (Shannon)</div>
                        <div class="text-3xl font-bold text-purple-700 dark:text-purple-300 mono">${entropia.toFixed(2)}</div>
                        <div class="text-xs text-slate-500 mt-1">Bits de informa√ß√£o</div>
                    </div>
                </div>
                
                <div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                    <div class="text-sm font-semibold mb-3">An√°lise Individual (Z-Scores)</div>
                    <div class="flex gap-2 flex-wrap">
                        ${numeros.map((n, i) => `
                            <div class="flex flex-col items-center p-2 bg-white dark:bg-slate-700 rounded-lg min-w-[60px]">
                                <div class="text-lg font-bold ${Math.abs(parseFloat(zScores[i])) > 1.5 ? 'text-red-500' : 'text-emerald-500'}">${n}</div>
                                <div class="text-xs text-slate-500 mono">${zScores[i]}œÉ</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-xl">
                    <div class="text-sm font-semibold mb-2">Diagn√≥stico Estat√≠stico</div>
                    <p class="text-sm text-slate-600 dark:text-slate-400">
                        ${gerarDiagnostico(numeros, zScores, mediaFreq, stats)}
                    </p>
                </div>
            `;
            
            // Adicionar √† lista de compara√ß√£o
            if (!jogosParaComparar.find(j => j.numeros.join(',') === numeros.sort((a,b)=>a-b).join(','))) {
                jogosParaComparar.push({ numeros: numeros.sort((a,b)=>a-b), mediaFreq, zScores });
            }
        }

        function gerarDiagnostico(numeros, zScores, mediaFreq, stats) {
            const desviosAltos = zScores.filter(z => Math.abs(parseFloat(z)) > 1.5).length;
            const soma = numeros.reduce((a,b) => a+b, 0);
            const mediaSoma = 183; // (1+60)*6/2
            
            let diag = [];
            if (desviosAltos === 0) diag.push("Distribui√ß√£o pr√≥xima da m√©dia (equilibrada).");
            else if (desviosAltos <= 2) diag.push("Alguns n√∫meros com frequ√™ncia at√≠pica.");
            else diag.push("Alta concentra√ß√£o de n√∫meros extremos (quentes ou frios).");
            
            if (Math.abs(soma - mediaSoma) < 20) diag.push("Soma pr√≥xima da m√©dia te√≥rica.");
            else diag.push(soma > mediaSoma ? "Tend√™ncia a n√∫meros altos." : "Tend√™ncia a n√∫meros baixos.");
            
            return diag.join(" ");
        }

        function compararJogos() {
            if (jogosParaComparar.length < 2) {
                alert('Analise pelo menos 2 jogos diferentes primeiro');
                return;
            }
            
            const div = document.getElementById('comparacao-multipla');
            div.classList.remove('hidden');
            
            const tbody = document.getElementById('tabela-comparacao');
            tbody.innerHTML = jogosParaComparar.map((jogo, idx) => {
                const score = (jogo.mediaFreq / calcularFrequencias().media * 100).toFixed(1);
                return `
                    <tr class="border-b border-slate-200 dark:border-slate-700">
                        <td class="p-3 font-mono text-xs">${jogo.numeros.map(n=>n.toString().padStart(2,'0')).join(', ')}</td>
                        <td class="p-3 text-center font-bold">${jogo.mediaFreq.toFixed(1)}</td>
                        <td class="p-3 text-center">${(jogo.zScores.reduce((a,b)=>a+Math.abs(parseFloat(b)),0)/6).toFixed(2)}</td>
                        <td class="p-3 text-center font-bold ${score > 100 ? 'text-red-500' : 'text-emerald-500'}">${score}%</td>
                        <td class="p-3 text-center text-slate-500">#${idx+1}</td>
                    </tr>
                `;
            }).join('');
        }

        function limparAnalise() {
            document.querySelectorAll('#input-analise input').forEach(i => i.value = '');
            document.getElementById('resultado-analise').classList.add('hidden');
            jogosParaComparar = [];
            document.getElementById('comparacao-multipla').classList.add('hidden');
        }

        function simularJogo() {
            const selecionados = Array.from(document.querySelectorAll('#grid-simulador input:checked')).map(cb => parseInt(cb.value));
            
            if (selecionados.length !== 6) {
                alert('Selecione exatamente 6 n√∫meros');
                return;
            }
            
            const periodo = document.getElementById('periodo-sim').value;
            const stats = calcularFrequencias(periodo);
            
            // An√°lise detalhada
            const freqInd = selecionados.map(n => stats.frequencias[n]);
            const mediaInd = freqInd.reduce((a,b) => a+b, 0) / 6;
            const zScore = (mediaInd - stats.media) / stats.desvio;
            
            // Verificar ocorr√™ncias exatas
            const jogoKey = selecionados.sort((a,b) => a-b).join(',');
            const ocorrencias = stats.dados.filter(c => c.numeros.join(',') === jogoKey).length;
            
            const container = document.getElementById('resultado-simulacao');
            container.classList.remove('hidden');
            container.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-xl text-center">
                            <div class="text-xs text-slate-500 mb-1">Prob. Te√≥rica</div>
                            <div class="text-xl font-bold mono">1/50.063.860</div>
                            <div class="text-xs text-slate-500">0,000002%</div>
                        </div>
                        <div class="p-4 bg-slate-100 dark:bg-slate-800 rounded-xl text-center">
                            <div class="text-xs text-slate-500 mb-1">Frequ√™ncia na Amostra</div>
                            <div class="text-xl font-bold mono ${ocorrencias > 0 ? 'text-emerald-500' : 'text-slate-400'}">${ocorrencias}x</div>
                            <div class="text-xs text-slate-500">${(ocorrencias/stats.total*100).toFixed(5)}%</div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl border border-blue-200 dark:border-blue-800">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold">Score Estrat√©gico</span>
                            <span class="text-2xl font-bold mono ${zScore > 0 ? 'text-red-500' : 'text-blue-500'}">${zScore > 0 ? '+' : ''}${zScore.toFixed(2)}œÉ</span>
                        </div>
                        <div class="w-full bg-slate-200 dark:bg-slate-700 rounded-full h-3">
                            <div class="h-3 rounded-full transition-all duration-1000 ${Math.abs(zScore) < 0.5 ? 'bg-emerald-500' : Math.abs(zScore) < 1.5 ? 'bg-yellow-500' : 'bg-red-500'}" 
                                style="width: ${Math.min(Math.abs(zScore)/3*50 + 50, 100)}%; margin-left: ${zScore < 0 ? '0' : 'auto'}; margin-right: ${zScore > 0 ? '0' : 'auto'}"></div>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500 mt-1">
                            <span>Frio</span>
                            <span>Neutro</span>
                            <span>Quente</span>
                        </div>
                    </div>
                    
                    <div class="text-xs text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-800 p-3 rounded-lg">
                        <strong>Interpreta√ß√£o:</strong> ${gerarInterpretacaoSim(zScore, ocorrencias)}
                    </div>
                </div>
            `;
        }

        function gerarInterpretacaoSim(zScore, ocorrencias) {
            if (Math.abs(zScore) < 0.5) return "Jogo equilibrado estatisticamente. Distribui√ß√£o pr√≥xima da m√©dia populacional.";
            if (zScore > 1.5) return "N√∫meros 'quentes' - alta frequ√™ncia hist√≥rica. Popularidade n√£o implica probabilidade futura.";
            if (zScore < -1.5) return "N√∫meros 'frios' - baixa frequ√™ncia hist√≥rica. Poss√≠vel vi√©s de recupera√ß√£o √† m√©dia.";
            return "Distribui√ß√£o moderadamente desviada da m√©dia.";
        }

        function simularMultiplos(n) {
            alert(`Simula√ß√£o de ${n} jogos seria executada aqui. Em produ√ß√£o, isso rodaria em worker threads para n√£o travar a UI.`);
        }

        function buscarRepeticao() {
            const input = document.getElementById('busca-historico').value;
            const numeros = input.split(',').map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n > 0 && n <= 60);
            
            if (numeros.length !== 6) {
                alert('Digite 6 n√∫meros separados por v√≠rgula');
                return;
            }
            
            const periodo = parseInt(document.getElementById('periodo-busca').value);
            const dados = historico.slice(-periodo);
            const jogoKey = numeros.sort((a,b) => a-b).join(',');
            
            const encontrados = dados.filter(c => c.numeros.join(',') === jogoKey);
            const resultadoDiv = document.getElementById('resultado-busca');
            
            resultadoDiv.classList.remove('hidden');
            resultadoDiv.innerHTML = encontrados.length > 0 ? `
                <div class="p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-full bg-red-500 flex items-center justify-center text-white text-xl">‚ö†Ô∏è</div>
                        <div>
                            <div class="font-bold text-red-700 dark:text-red-400">Jogo j√° ocorrido!</div>
                            <div class="text-sm text-slate-600 dark:text-slate-400">${encontrados.length} vez(es) no per√≠odo</div>
                        </div>
                    </div>
                    <div class="space-y-2 max-h-48 overflow-y-auto">
                        ${encontrados.map(e => `
                            <div class="flex justify-between p-2 bg-white dark:bg-slate-800 rounded text-sm">
                                <span class="mono font-bold">Concurso ${e.concurso}</span>
                                <span class="text-slate-500">${new Date(e.data).toLocaleDateString('pt-BR')}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : `
                <div class="p-4 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-200 dark:border-emerald-800 rounded-xl flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-emerald-500 flex items-center justify-center text-white text-xl">‚úì</div>
                    <div>
                        <div class="font-bold text-emerald-700 dark:text-emerald-400">Jogo √∫nico no per√≠odo</div>
                        <div class="text-sm text-slate-600 dark:text-slate-400">Esta combina√ß√£o espec√≠fica nunca ocorreu</div>
                    </div>
                </div>
            `;
        }

        function calcularStatsRepeticoes() {
            const jogosMap = new Map();
            historico.forEach(h => {
                const key = h.numeros.join(',');
                jogosMap.set(key, (jogosMap.get(key) || 0) + 1);
            });
            
            const unicos = jogosMap.size;
            const repeticoes = historico.length - unicos;
            const maxRep = Math.max(...jogosMap.values());
            
            document.getElementById('stat-unicos').textContent = unicos.toLocaleString();
            document.getElementById('stat-repeticoes').textContent = repeticoes;
            document.getElementById('stat-sequencia').textContent = maxRep;
        }

        // ==================== EXPORTA√á√ÉO ====================
        
        function exportData() {
            const stats = calcularFrequencias();
            const data = {
                estatisticas: {
                    amostra: stats.total,
                    media: stats.media,
                    desvio: stats.desvio,
                    chi2: document.getElementById('stat-chi').textContent
                },
                frequencias: stats.frequencias.slice(1).map((f, i) => ({ numero: i+1, frequencia: f })),
                timestamp: new Date().toISOString()
            };
            
            // Exportar como JSON
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `econoloteria_analise_${Date.now()}.json`;
            a.click();
            
            // Tamb√©m exportar como Excel
            const ws = XLSX.utils.json_to_sheet(data.frequencias);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Frequencias");
            XLSX.writeFile(wb, `econoloteria_frequencias_${Date.now()}.xlsx`);
        }

        // ==================== UTILIT√ÅRIOS ====================
        
        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function atualizarDashboard() {
            calcularEstatisticas();
            atualizarHeatmaps();
            // Atualizar gr√°ficos se necess√°rio
            if (chartInstances.freq) {
                const stats = calcularFrequencias();
                chartInstances.freq.data.datasets[0].data = stats.frequencias.slice(1);
                chartInstances.freq.data.datasets[0].backgroundColor = stats.frequencias.slice(1).map(f => {
                    const z = (f - stats.media) / stats.desvio;
                    if (z > 1.5) return 'rgba(239, 68, 68, 0.8)';
                    if (z < -1.5) return 'rgba(59, 130, 246, 0.8)';
                    return 'rgba(148, 163, 184, 0.5)';
                });
                chartInstances.freq.data.datasets[1].data = Array(60).fill(stats.media);
                chartInstances.freq.update();
            }
        }

        // Iniciar
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>